<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="æ—…éŠè¦åŠƒé«˜æ‰‹">
    <meta name="theme-color" content="#0f172a">
    <title>æ—…éŠè¦åŠƒé«˜æ‰‹ v3</title>
    
    <link rel="manifest" href="data:application/json;charset=utf-8,%7B%22name%22%3A%22%E6%97%85%E9%81%8A%E8%A6%8F%E5%8A%83%E9%AB%98%E6%89%8B%22%2C%22short_name%22%3A%22%E6%97%85%E9%81%8A%E8%A6%8F%E5%8A%83%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%230f172a%22%2C%22theme_color%22%3A%22%2306b6d4%22%7D">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Crect width='180' height='180' fill='%230f172a' rx='40'/%3E%3Ctext x='90' y='100' font-size='100' text-anchor='middle'%3Eâœˆï¸%3C/text%3E%3C/svg%3E">
    
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-card-hover: #334155;
            --cyan: #06b6d4;
            --cyan-glow: rgba(6, 182, 212, 0.3);
            --purple: #a855f7;
            --purple-glow: rgba(168, 85, 247, 0.3);
            --emerald: #10b981;
            --emerald-glow: rgba(16, 185, 129, 0.3);
            --orange: #f59e0b;
            --orange-glow: rgba(245, 158, 11, 0.3);
            --pink: #ec4899;
            --pink-glow: rgba(236, 72, 153, 0.3);
            --red: #ef4444;
            --text-light: #e2e8f0;
            --text-dim: #94a3b8;
            --text-muted: #64748b;
            --border: #334155;
            --nav-height: 70px;
            --header-height: 60px;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html, body { height: 100%; overflow: hidden; touch-action: manipulation; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', sans-serif; background: var(--bg-dark); color: var(--text-light); line-height: 1.5; }
        
        .app-container { height: 100%; display: flex; flex-direction: column; padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom); }
        
        .app-header { height: var(--header-height); background: linear-gradient(135deg, var(--cyan) 0%, var(--purple) 100%); display: flex; align-items: center; justify-content: space-between; padding: 0 16px; flex-shrink: 0; }
        .app-logo { display: flex; align-items: center; gap: 10px; font-size: 1.2em; font-weight: 700; }
        .header-actions { display: flex; gap: 8px; }
        .header-btn { width: 40px; height: 40px; border: none; background: rgba(255,255,255,0.2); border-radius: 12px; color: white; font-size: 1.3em; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        
        .app-content { flex: 1; overflow: hidden; position: relative; }
        .page { position: absolute; top: 0; left: 0; right: 0; bottom: 0; overflow-y: auto; padding: 16px; padding-bottom: calc(var(--nav-height) + 20px); display: none; -webkit-overflow-scrolling: touch; }
        .page.active { display: block; }
        
        .bottom-nav { height: var(--nav-height); background: var(--bg-card); border-top: 1px solid var(--border); display: flex; flex-shrink: 0; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; border: none; background: transparent; color: var(--text-muted); padding: 8px 0; cursor: pointer; position: relative; }
        .nav-item::before { content: ''; position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 0; height: 3px; background: var(--cyan); border-radius: 0 0 3px 3px; transition: width 0.3s; }
        .nav-item.active { color: var(--cyan); }
        .nav-item.active::before { width: 30px; }
        .nav-icon { font-size: 1.5em; }
        .nav-label { font-size: 0.7em; font-weight: 500; }
        
        .card { background: var(--bg-card); border-radius: 16px; padding: 16px; margin-bottom: 16px; border: 1px solid var(--border); }
        .card-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .card-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2em; }
        .card-icon.cyan { background: var(--cyan-glow); }
        .card-icon.purple { background: var(--purple-glow); }
        .card-icon.emerald { background: var(--emerald-glow); }
        .card-icon.orange { background: var(--orange-glow); }
        .card-icon.pink { background: var(--pink-glow); }
        .card-title { font-size: 1em; font-weight: 600; }
        .card-subtitle { font-size: 0.8em; color: var(--text-dim); }
        
        .stats-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 16px; }
        .stat-card { background: var(--bg-card); border-radius: 12px; padding: 12px; text-align: center; border: 1px solid var(--border); }
        .stat-value { font-size: 1.4em; font-weight: 700; }
        .stat-value.cyan { color: var(--cyan); }
        .stat-value.orange { color: var(--orange); }
        .stat-value.emerald { color: var(--emerald); }
        .stat-label { font-size: 0.7em; color: var(--text-muted); margin-top: 2px; }
        
        .input-group { margin-bottom: 14px; }
        .input-label { display: block; font-size: 0.85em; font-weight: 500; color: var(--text-dim); margin-bottom: 6px; }
        .input-field { width: 100%; padding: 12px 14px; background: var(--bg-dark); border: 2px solid var(--border); border-radius: 10px; color: var(--text-light); font-size: 1em; -webkit-appearance: none; }
        .input-field:focus { outline: none; border-color: var(--cyan); }
        select.input-field { cursor: pointer; }
        textarea.input-field { min-height: 80px; resize: vertical; }
        
        .input-row { display: flex; gap: 10px; }
        .input-row .input-group { flex: 1; margin-bottom: 0; }
        .input-row-btn { display: flex; gap: 8px; }
        .input-row-btn .input-field { flex: 1; }
        .input-btn { width: 50px; height: 48px; border: none; background: var(--bg-card-hover); border-radius: 10px; color: var(--text-dim); font-size: 1.2em; cursor: pointer; flex-shrink: 0; }
        
        .btn { width: 100%; padding: 14px 20px; border: none; border-radius: 12px; font-size: 1em; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer; }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: linear-gradient(135deg, var(--cyan) 0%, var(--purple) 100%); color: white; }
        .btn-secondary { background: linear-gradient(135deg, var(--emerald) 0%, #059669 100%); color: white; }
        .btn-orange { background: linear-gradient(135deg, var(--orange) 0%, #d97706 100%); color: white; }
        .btn-pink { background: linear-gradient(135deg, var(--pink) 0%, #db2777 100%); color: white; }
        .btn-outline { background: transparent; border: 2px solid var(--cyan); color: var(--cyan); }
        .btn-danger { background: var(--red); color: white; }
        .btn-sm { padding: 10px 14px; font-size: 0.9em; }
        .btn-xs { padding: 8px 12px; font-size: 0.8em; border-radius: 8px; }
        
        .action-row { display: flex; gap: 10px; margin-top: 14px; }
        .action-row .btn { flex: 1; }
        
        .trip-banner { background: linear-gradient(135deg, var(--cyan-glow) 0%, var(--purple-glow) 100%); border-radius: 16px; padding: 20px; margin-bottom: 16px; border: 1px solid var(--border); text-align: center; }
        .trip-name { font-size: 1.5em; font-weight: 700; margin-bottom: 4px; }
        .trip-dest { font-size: 1em; color: var(--cyan); margin-bottom: 8px; }
        .trip-dates { font-size: 0.85em; color: var(--text-dim); }
        
        .day-card { background: var(--bg-card); border-radius: 14px; margin-bottom: 14px; border: 1px solid var(--border); overflow: hidden; }
        .day-header { padding: 14px; background: linear-gradient(135deg, var(--cyan-glow) 0%, var(--purple-glow) 100%); display: flex; align-items: center; justify-content: space-between; cursor: pointer; }
        .day-title { font-weight: 600; }
        .day-date { font-size: 0.8em; color: var(--text-dim); }
        .day-content { padding: 14px; display: none; }
        .day-content.show { display: block; }
        
        .schedule-item { background: var(--bg-dark); border-radius: 10px; padding: 12px; margin-bottom: 10px; border-left: 3px solid var(--cyan); }
        .schedule-item.has-reminder { border-left-color: var(--orange); }
        .schedule-item.synced { border-left-color: var(--emerald); }
        .schedule-time { font-size: 0.8em; color: var(--cyan); font-weight: 600; }
        .schedule-title { font-size: 0.95em; font-weight: 500; margin: 4px 0; }
        .schedule-location { font-size: 0.8em; color: var(--text-dim); }
        .schedule-actions { display: flex; gap: 6px; margin-top: 8px; flex-wrap: wrap; }
        .schedule-badge { font-size: 0.7em; padding: 2px 8px; border-radius: 10px; }
        .schedule-badge.reminder { background: var(--orange-glow); color: var(--orange); }
        .schedule-badge.synced { background: var(--emerald-glow); color: var(--emerald); }
        
        .expense-item { background: var(--bg-dark); border-radius: 10px; padding: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .expense-info { flex: 1; }
        .expense-category { font-size: 0.75em; color: var(--text-muted); }
        .expense-name { font-size: 0.95em; font-weight: 500; }
        .expense-meta { font-size: 0.75em; color: var(--text-dim); margin-top: 2px; }
        .expense-amount { font-size: 1.1em; font-weight: 700; }
        .expense-amount.jpy { color: var(--orange); }
        .expense-amount.twd { color: var(--emerald); }
        .expense-delete { color: var(--text-muted); padding: 8px; cursor: pointer; }
        
        .shop-item { background: var(--bg-dark); border-radius: 10px; padding: 12px; margin-bottom: 10px; display: flex; align-items: center; gap: 12px; }
        .shop-item.bought { opacity: 0.5; }
        .shop-checkbox { width: 24px; height: 24px; border: 2px solid var(--border); border-radius: 6px; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0; }
        .shop-item.bought .shop-checkbox { background: var(--emerald); border-color: var(--emerald); }
        .shop-info { flex: 1; }
        .shop-name { font-size: 0.95em; font-weight: 500; }
        .shop-item.bought .shop-name { text-decoration: line-through; }
        .shop-meta { font-size: 0.75em; color: var(--text-dim); }
        .shop-priority { font-size: 0.7em; padding: 2px 8px; border-radius: 10px; }
        .shop-priority.high { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .shop-priority.medium { background: var(--orange-glow); color: var(--orange); }
        .shop-priority.low { background: var(--emerald-glow); color: var(--emerald); }
        
        .reminder-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-top: 10px; }
        .reminder-option { display: flex; align-items: center; gap: 8px; padding: 10px; background: var(--bg-dark); border: 2px solid var(--border); border-radius: 10px; cursor: pointer; font-size: 0.85em; }
        .reminder-option.checked { border-color: var(--cyan); background: var(--cyan-glow); }
        .reminder-checkbox { width: 20px; height: 20px; border: 2px solid var(--border); border-radius: 4px; display: flex; align-items: center; justify-content: center; }
        .reminder-option.checked .reminder-checkbox { background: var(--cyan); border-color: var(--cyan); }
        
        .setting-item { display: flex; align-items: center; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid var(--border); }
        .setting-item:last-child { border-bottom: none; }
        .setting-info { flex: 1; }
        .setting-label { font-size: 0.95em; font-weight: 500; }
        .setting-status { font-size: 0.8em; color: var(--text-dim); }
        
        .toggle { width: 50px; height: 28px; background: var(--border); border-radius: 14px; position: relative; cursor: pointer; transition: background 0.3s; }
        .toggle.active { background: var(--cyan); }
        .toggle::after { content: ''; position: absolute; top: 3px; left: 3px; width: 22px; height: 22px; background: white; border-radius: 50%; transition: transform 0.3s; }
        .toggle.active::after { transform: translateX(22px); }
        
        .auth-status { margin-top: 8px; padding: 10px; border-radius: 8px; font-size: 0.85em; }
        .auth-status.success { background: var(--emerald-glow); color: var(--emerald); }
        .auth-status.error { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: none; align-items: flex-end; justify-content: center; z-index: 1000; }
        .modal-overlay.show { display: flex; }
        .modal { background: var(--bg-card); border-radius: 20px 20px 0 0; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; padding: 20px; padding-bottom: calc(20px + env(safe-area-inset-bottom)); animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .modal-handle { width: 40px; height: 4px; background: var(--border); border-radius: 2px; margin: 0 auto 16px; }
        .modal-title { font-size: 1.1em; font-weight: 600; text-align: center; margin-bottom: 16px; }
        
        .toast { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); background: var(--bg-card); color: var(--text-light); padding: 12px 20px; border-radius: 10px; font-size: 0.9em; z-index: 2000; opacity: 0; transition: opacity 0.3s; border: 1px solid var(--border); max-width: calc(100% - 40px); text-align: center; }
        .toast.show { opacity: 1; }
        .toast.success { border-color: var(--emerald); }
        .toast.error { border-color: var(--red); }
        
        .progress-bar { height: 8px; background: var(--bg-dark); border-radius: 4px; overflow: hidden; margin-top: 8px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--cyan), var(--purple)); border-radius: 4px; transition: width 0.5s ease; }
        
        .empty-state { text-align: center; padding: 40px 20px; color: var(--text-muted); }
        .empty-icon { font-size: 3em; margin-bottom: 12px; }
        
        .fab { position: fixed; bottom: calc(var(--nav-height) + 20px + env(safe-area-inset-bottom)); right: 20px; width: 56px; height: 56px; border-radius: 50%; background: linear-gradient(135deg, var(--cyan), var(--purple)); color: white; border: none; font-size: 1.5em; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4); cursor: pointer; z-index: 100; }
        
        /* å»ºè­°é¸å–®æ¨£å¼ */
        .suggest-section { background: var(--bg-dark); border-radius: 10px; padding: 12px; margin-bottom: 14px; }
        .suggest-title { font-size: 0.85em; color: var(--cyan); margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
        .suggest-chips { display: flex; flex-wrap: wrap; gap: 8px; }
        .suggest-chip { padding: 8px 12px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px; font-size: 0.85em; cursor: pointer; transition: all 0.2s; }
        .suggest-chip:hover, .suggest-chip:active { background: var(--cyan-glow); border-color: var(--cyan); }
        .suggest-chip.selected { background: var(--cyan); color: white; border-color: var(--cyan); }
        
        /* è‡ªå‹•ç”¢ç”ŸæŒ‰éˆ• */
        .auto-generate-btn { background: linear-gradient(135deg, var(--purple) 0%, var(--pink) 100%); margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="app-logo">âœˆï¸ æ—…éŠè¦åŠƒé«˜æ‰‹</div>
            <div class="header-actions">
                <button class="header-btn" onclick="showModal('exportModal')">ğŸ“Š</button>
                <button class="header-btn" onclick="switchPage('settings')">âš™ï¸</button>
            </div>
        </header>
        
        <main class="app-content">
            <!-- é¦–é  -->
            <div id="page-home" class="page active">
                <div class="trip-banner">
                    <div class="trip-name" id="displayTripName">æˆ‘çš„æ—…è¡Œ</div>
                    <div class="trip-dest" id="displayDestination">ğŸŒ é»æ“Šä¸‹æ–¹è¨­å®šç›®çš„åœ°</div>
                    <div class="trip-dates" id="displayDates">ğŸ“… å°šæœªè¨­å®šæ—¥æœŸ</div>
                </div>
                
                <div class="stats-row">
                    <div class="stat-card">
                        <div class="stat-value cyan" id="statDays">0</div>
                        <div class="stat-label">å¤©æ•¸</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value orange" id="statExpenseJPY">Â¥0</div>
                        <div class="stat-label">æ—¥å¹£èŠ±è²»</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value emerald" id="statExpenseTWD">$0</div>
                        <div class="stat-label">å°å¹£èŠ±è²»</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon cyan">ğŸ¯</div>
                        <div><div class="card-title">æ—…éŠè¨­å®š</div><div class="card-subtitle">è¨­å®šæ‚¨çš„æ—…è¡Œè³‡è¨Š</div></div>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">æ—…éŠåç¨±</label>
                        <input type="text" class="input-field" id="tripName" placeholder="ä¾‹ï¼š2025 æ±äº¬è‡ªç”±è¡Œ" onchange="updateTripInfo()">
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">ç›®çš„åœ°</label>
                        <select class="input-field" id="destination" onchange="handleDestinationChange()">
                            <option value="">è«‹é¸æ“‡ç›®çš„åœ°</option>
                            <optgroup label="ğŸ‡¯ğŸ‡µ æ—¥æœ¬">
                                <option value="ğŸ‡¯ğŸ‡µ æ±äº¬">ğŸ‡¯ğŸ‡µ æ±äº¬</option>
                                <option value="ğŸ‡¯ğŸ‡µ å¤§é˜ª">ğŸ‡¯ğŸ‡µ å¤§é˜ª</option>
                                <option value="ğŸ‡¯ğŸ‡µ äº¬éƒ½">ğŸ‡¯ğŸ‡µ äº¬éƒ½</option>
                                <option value="ğŸ‡¯ğŸ‡µ åŒ—æµ·é“">ğŸ‡¯ğŸ‡µ åŒ—æµ·é“</option>
                                <option value="ğŸ‡¯ğŸ‡µ æ²–ç¹©">ğŸ‡¯ğŸ‡µ æ²–ç¹©</option>
                                <option value="ğŸ‡¯ğŸ‡µ ä¹å·">ğŸ‡¯ğŸ‡µ ä¹å·</option>
                                <option value="ğŸ‡¯ğŸ‡µ åå¤å±‹">ğŸ‡¯ğŸ‡µ åå¤å±‹</option>
                                <option value="ğŸ‡¯ğŸ‡µ ç¦å²¡">ğŸ‡¯ğŸ‡µ ç¦å²¡</option>
                            </optgroup>
                            <optgroup label="ğŸ‡°ğŸ‡· éŸ“åœ‹">
                                <option value="ğŸ‡°ğŸ‡· é¦–çˆ¾">ğŸ‡°ğŸ‡· é¦–çˆ¾</option>
                                <option value="ğŸ‡°ğŸ‡· é‡œå±±">ğŸ‡°ğŸ‡· é‡œå±±</option>
                                <option value="ğŸ‡°ğŸ‡· æ¿Ÿå·å³¶">ğŸ‡°ğŸ‡· æ¿Ÿå·å³¶</option>
                            </optgroup>
                            <optgroup label="ğŸŒ æ±å—äº">
                                <option value="ğŸ‡¹ğŸ‡­ æ³°åœ‹">ğŸ‡¹ğŸ‡­ æ³°åœ‹</option>
                                <option value="ğŸ‡»ğŸ‡³ è¶Šå—">ğŸ‡»ğŸ‡³ è¶Šå—</option>
                                <option value="ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡">ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡</option>
                            </optgroup>
                            <optgroup label="ğŸŒ å…¶ä»–">
                                <option value="custom">âœï¸ è‡ªè¨‚...</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="input-group" id="customDestGroup" style="display:none;">
                        <input type="text" class="input-field" id="customDestination" placeholder="è¼¸å…¥è‡ªè¨‚ç›®çš„åœ°" onchange="updateTripInfo()">
                    </div>
                    
                    <div class="input-row" style="margin-bottom:14px;">
                        <div class="input-group">
                            <label class="input-label">å‡ºç™¼æ—¥æœŸ</label>
                            <input type="date" class="input-field" id="startDate" onchange="updateTripInfo()">
                        </div>
                        <div class="input-group">
                            <label class="input-label">çµæŸæ—¥æœŸ</label>
                            <input type="date" class="input-field" id="endDate" onchange="updateTripInfo()">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">ä¸»è¦å¹£åˆ¥</label>
                        <select class="input-field" id="mainCurrency" onchange="saveData()">
                            <option value="JPY">ğŸ‡¯ğŸ‡µ æ—¥å¹£ (JPY)</option>
                            <option value="KRW">ğŸ‡°ğŸ‡· éŸ“å…ƒ (KRW)</option>
                            <option value="THB">ğŸ‡¹ğŸ‡­ æ³°éŠ– (THB)</option>
                            <option value="USD">ğŸ‡ºğŸ‡¸ ç¾å…ƒ (USD)</option>
                            <option value="TWD">ğŸ‡¹ğŸ‡¼ å°å¹£ (TWD)</option>
                        </select>
                    </div>
                </div>
                
                <!-- ğŸ†• è‡ªå‹•ç”¢ç”Ÿè¡Œç¨‹æŒ‰éˆ• -->
                <button class="btn auto-generate-btn" onclick="showAutoGenerateModal()">
                    âœ¨ è‡ªå‹•ç”¢ç”Ÿå»ºè­°è¡Œç¨‹
                </button>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon purple">âš¡</div>
                        <div><div class="card-title">å¿«é€ŸåŠŸèƒ½</div></div>
                    </div>
                    <div class="stats-row" style="margin-bottom:0;">
                        <div class="stat-card" style="cursor:pointer;" onclick="switchPage('itinerary')">
                            <div style="font-size:1.5em;">ğŸ“…</div>
                            <div class="stat-label">è¡Œç¨‹</div>
                        </div>
                        <div class="stat-card" style="cursor:pointer;" onclick="switchPage('expense')">
                            <div style="font-size:1.5em;">ğŸ’°</div>
                            <div class="stat-label">è¨˜å¸³</div>
                        </div>
                        <div class="stat-card" style="cursor:pointer;" onclick="switchPage('shopping')">
                            <div style="font-size:1.5em;">ğŸ›’</div>
                            <div class="stat-label">è³¼ç‰©</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- è¡Œç¨‹é é¢ -->
            <div id="page-itinerary" class="page">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon cyan">ğŸ“…</div>
                        <div><div class="card-title">æ¯æ—¥è¡Œç¨‹</div><div class="card-subtitle">è¦åŠƒæ‚¨çš„æ—…éŠè¡Œç¨‹</div></div>
                    </div>
                    <button class="btn btn-secondary btn-sm" onclick="syncAllToGoogleCalendar()" style="margin-bottom:10px;">
                        ğŸ“† åŒæ­¥å…¨éƒ¨åˆ° Google æ—¥æ›†
                    </button>
                </div>
                
                <div id="itineraryList"></div>
                
                <button class="btn btn-outline" onclick="showAddDayModal()" style="margin-top:10px;">â• æ–°å¢ä¸€å¤©</button>
            </div>
            
            <!-- è¨˜å¸³é é¢ -->
            <div id="page-expense" class="page">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon orange">ğŸ’°</div>
                        <div><div class="card-title">æ—…éŠè¨˜å¸³</div><div class="card-subtitle">è¨˜éŒ„æ‚¨çš„èŠ±è²»</div></div>
                    </div>
                    <div class="stats-row">
                        <div class="stat-card">
                            <div class="stat-value orange" id="expenseJPY">Â¥0</div>
                            <div class="stat-label">æ—¥å¹£</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value emerald" id="expenseTWD">$0</div>
                            <div class="stat-label">å°å¹£</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value pink" id="expenseCount">0</div>
                            <div class="stat-label">ç­†</div>
                        </div>
                    </div>
                    <div class="input-group">
                        <select class="input-field" id="expenseFilterDate" onchange="renderExpenses()">
                            <option value="all">å…¨éƒ¨æ—¥æœŸ</option>
                        </select>
                    </div>
                </div>
                <div id="expenseList"></div>
                <button class="fab" onclick="showAddExpenseModal()">â•</button>
            </div>
            
            <!-- è³¼ç‰©æ¸…å–®é é¢ -->
            <div id="page-shopping" class="page">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon pink">ğŸ›’</div>
                        <div><div class="card-title">è³¼ç‰©æ¸…å–®</div><div class="card-subtitle">æƒ³è²·çš„æ±è¥¿</div></div>
                    </div>
                    <div style="display:flex;justify-content:space-between;font-size:0.85em;color:var(--text-dim);">
                        <span>å®Œæˆé€²åº¦</span>
                        <span id="shoppingProgress">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="shoppingProgressBar" style="width:0%"></div>
                    </div>
                </div>
                <div id="shoppingList"></div>
                <button class="fab" onclick="showAddShoppingModal()">â•</button>
            </div>
            
            <!-- è¨­å®šé é¢ -->
            <div id="page-settings" class="page">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon cyan">ğŸ“†</div>
                        <div><div class="card-title">Google æ—¥æ›†</div><div class="card-subtitle">åŒæ­¥è¡Œç¨‹åˆ° Google Calendar</div></div>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Google OAuth Client ID</label>
                        <div class="input-row-btn">
                            <input type="password" class="input-field" id="googleClientId" placeholder="è¼¸å…¥ Client ID" onchange="saveSettings()">
                            <button class="input-btn" onclick="toggleVisibility('googleClientId')">ğŸ‘ï¸</button>
                        </div>
                    </div>
                    <button class="btn btn-outline btn-sm" onclick="handleGoogleAuthorize()">ğŸ” æˆæ¬Š Google æ—¥æ›†</button>
                    <div id="googleAuthStatus" class="auth-status" style="display:none;"></div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon emerald">ğŸ””</div>
                        <div><div class="card-title">LINE æé†’è¨­å®š</div><div class="card-subtitle">è¨­å®šè¡Œç¨‹æé†’é€šçŸ¥</div></div>
                    </div>
                    <div class="input-group">
                        <label class="input-label">LINE Channel Access Token</label>
                        <div class="input-row-btn">
                            <input type="password" class="input-field" id="lineToken" placeholder="è²¼ä¸Šæ‚¨çš„ Token" onchange="saveSettings()">
                            <button class="input-btn" onclick="toggleVisibility('lineToken')">ğŸ‘ï¸</button>
                        </div>
                    </div>
                    <div class="input-group">
                        <label class="input-label">LINE User ID</label>
                        <div class="input-row-btn">
                            <input type="password" class="input-field" id="lineUserId" placeholder="æ‚¨çš„ LINE User ID" onchange="saveSettings()">
                            <button class="input-btn" onclick="toggleVisibility('lineUserId')">ğŸ‘ï¸</button>
                        </div>
                    </div>
                    <div class="input-group">
                        <label class="input-label">GAS Web App URL</label>
                        <div class="input-row-btn">
                            <input type="password" class="input-field" id="gasUrl" placeholder="https://script.google.com/..." onchange="saveSettings()">
                            <button class="input-btn" onclick="toggleVisibility('gasUrl')">ğŸ‘ï¸</button>
                        </div>
                    </div>
                    <div class="input-group">
                        <label class="input-label">GAS Secret Key</label>
                        <div class="input-row-btn">
                            <input type="password" class="input-field" id="gasSecret" placeholder="æ‚¨è¨­å®šçš„æš—è™Ÿ" onchange="saveSettings()">
                            <button class="input-btn" onclick="toggleVisibility('gasSecret')">ğŸ‘ï¸</button>
                        </div>
                    </div>
                    <div class="action-row">
                        <button class="btn btn-outline btn-sm" onclick="testLineNotification()">ğŸ“¨ æ¸¬è©¦é€šçŸ¥</button>
                        <button class="btn btn-secondary btn-sm" onclick="viewSchedules()">ğŸ“‹ æŸ¥çœ‹æ’ç¨‹</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon purple">ğŸ’¾</div>
                        <div><div class="card-title">è³‡æ–™ç®¡ç†</div></div>
                    </div>
                    <div class="setting-item">
                        <div style="display:flex;align-items:center;">
                            <span style="font-size:1.2em;margin-right:12px;">ğŸ’¾</span>
                            <div class="setting-info">
                                <div class="setting-label">æœ¬æ©Ÿå„²å­˜</div>
                                <div class="setting-status">è‡ªå‹•ä¿å­˜è³‡æ–™</div>
                            </div>
                        </div>
                        <div class="toggle active" id="storageToggle" onclick="toggleStorage()"></div>
                    </div>
                    <div class="action-row">
                        <button class="btn btn-outline btn-sm" onclick="exportToExcel()">ğŸ“Š åŒ¯å‡º Excel</button>
                        <button class="btn btn-danger btn-sm" onclick="clearAllData()">ğŸ—‘ï¸ æ¸…é™¤è³‡æ–™</button>
                    </div>
                </div>
            </div>
        </main>
        
        <nav class="bottom-nav">
            <button class="nav-item active" onclick="switchPage('home')">
                <span class="nav-icon">ğŸ </span><span class="nav-label">é¦–é </span>
            </button>
            <button class="nav-item" onclick="switchPage('itinerary')">
                <span class="nav-icon">ğŸ“…</span><span class="nav-label">è¡Œç¨‹</span>
            </button>
            <button class="nav-item" onclick="switchPage('expense')">
                <span class="nav-icon">ğŸ’°</span><span class="nav-label">è¨˜å¸³</span>
            </button>
            <button class="nav-item" onclick="switchPage('shopping')">
                <span class="nav-icon">ğŸ›’</span><span class="nav-label">è³¼ç‰©</span>
            </button>
            <button class="nav-item" onclick="switchPage('settings')">
                <span class="nav-icon">âš™ï¸</span><span class="nav-label">è¨­å®š</span>
            </button>
        </nav>
    </div>
    
    <div class="toast" id="toast"></div>
    
    <!-- Modal: è‡ªå‹•ç”¢ç”Ÿè¡Œç¨‹ -->
    <div class="modal-overlay" id="autoGenerateModal">
        <div class="modal">
            <div class="modal-handle"></div>
            <div class="modal-title">âœ¨ è‡ªå‹•ç”¢ç”Ÿå»ºè­°è¡Œç¨‹</div>
            
            <div id="autoGenerateContent">
                <p style="color:var(--text-dim);text-align:center;padding:20px;">
                    è«‹å…ˆåœ¨é¦–é è¨­å®š<strong>ç›®çš„åœ°</strong>å’Œ<strong>æ—¥æœŸ</strong>
                </p>
            </div>
            
            <div class="action-row">
                <button class="btn btn-outline" onclick="closeModal('autoGenerateModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="confirmAutoGenerate" onclick="confirmAutoGenerate()">ğŸš€ ç”¢ç”Ÿè¡Œç¨‹</button>
            </div>
        </div>
    </div>
    
    <!-- Modal: æ–°å¢è¡Œç¨‹ï¼ˆå«å»ºè­°é¸å–®ï¼‰ -->
    <div class="modal-overlay" id="scheduleModal">
        <div class="modal">
            <div class="modal-handle"></div>
            <div class="modal-title">ğŸ“ æ–°å¢è¡Œç¨‹</div>
            
            <!-- ğŸ†• å»ºè­°æ™¯é»å€ -->
            <div class="suggest-section" id="suggestSection">
                <div class="suggest-title">ğŸ’¡ ç†±é–€æ™¯é»æ¨è–¦</div>
                <div class="suggest-chips" id="suggestChips"></div>
            </div>
            
            <div class="input-group">
                <label class="input-label">é¸æ“‡æ—¥æœŸ</label>
                <select class="input-field" id="scheduleDay"></select>
            </div>
            
            <div class="input-row" style="margin-bottom:14px;">
                <div class="input-group">
                    <label class="input-label">é–‹å§‹æ™‚é–“</label>
                    <input type="time" class="input-field" id="scheduleStartTime" value="09:00">
                </div>
                <div class="input-group">
                    <label class="input-label">çµæŸæ™‚é–“</label>
                    <input type="time" class="input-field" id="scheduleEndTime" value="10:00">
                </div>
            </div>
            
            <div class="input-group">
                <label class="input-label">æ´»å‹•åç¨±</label>
                <input type="text" class="input-field" id="scheduleTitle" placeholder="ä¾‹ï¼šåƒè§€æ±äº¬éµå¡”">
            </div>
            
            <div class="input-group">
                <label class="input-label">é¡å‹</label>
                <select class="input-field" id="scheduleType">
                    <option value="æ™¯é»">ğŸ›ï¸ æ™¯é»</option>
                    <option value="ç¾é£Ÿ">ğŸœ ç¾é£Ÿ</option>
                    <option value="äº¤é€š">ğŸšƒ äº¤é€š</option>
                    <option value="ä½å®¿">ğŸ¨ ä½å®¿</option>
                    <option value="è³¼ç‰©">ğŸ›ï¸ è³¼ç‰©</option>
                    <option value="å…¶ä»–">ğŸ“Œ å…¶ä»–</option>
                </select>
            </div>
            
            <div class="input-group">
                <label class="input-label">åœ°é» (é¸å¡«)</label>
                <input type="text" class="input-field" id="scheduleLocation" placeholder="ä¾‹ï¼šæ±äº¬éƒ½æ¸¯å€">
            </div>
            
            <div class="input-group">
                <label class="input-label">å‚™è¨» (é¸å¡«)</label>
                <textarea class="input-field" id="scheduleNote" placeholder="å…¶ä»–å‚™è¨»..." style="min-height:60px;"></textarea>
            </div>
            
            <div class="input-group">
                <label class="input-label">ğŸ”” LINE æé†’</label>
                <div class="reminder-grid">
                    <label class="reminder-option" onclick="toggleReminder(this)">
                        <div class="reminder-checkbox">âœ“</div><span>å‰ 1 å¤©</span>
                        <input type="checkbox" value="1440">
                    </label>
                    <label class="reminder-option" onclick="toggleReminder(this)">
                        <div class="reminder-checkbox">âœ“</div><span>å‰ 2 å°æ™‚</span>
                        <input type="checkbox" value="120">
                    </label>
                    <label class="reminder-option" onclick="toggleReminder(this)">
                        <div class="reminder-checkbox">âœ“</div><span>å‰ 1 å°æ™‚</span>
                        <input type="checkbox" value="60">
                    </label>
                    <label class="reminder-option" onclick="toggleReminder(this)">
                        <div class="reminder-checkbox">âœ“</div><span>å‰ 30 åˆ†é˜</span>
                        <input type="checkbox" value="30">
                    </label>
                </div>
            </div>
            
            <div class="input-group">
                <label class="reminder-option" onclick="toggleReminder(this)" style="width:100%;">
                    <div class="reminder-checkbox">âœ“</div>
                    <span>ğŸ“† åŒæ­¥åˆ° Google æ—¥æ›†</span>
                    <input type="checkbox" id="syncToGoogle" value="google">
                </label>
            </div>
            
            <div class="action-row">
                <button class="btn btn-outline" onclick="closeModal('scheduleModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveSchedule()">å„²å­˜</button>
            </div>
        </div>
    </div>
    
    <!-- Modal: å…¶ä»– (è¨˜å¸³ã€è³¼ç‰©ã€å¤©æ•¸ã€åŒ¯å‡º) -->
    <div class="modal-overlay" id="expenseModal">
        <div class="modal">
            <div class="modal-handle"></div>
            <div class="modal-title">ğŸ’° æ–°å¢èŠ±è²»</div>
            <div class="input-row" style="margin-bottom:14px;">
                <div class="input-group"><label class="input-label">æ—¥æœŸ</label><select class="input-field" id="expenseDay"></select></div>
                <div class="input-group"><label class="input-label">é¡åˆ¥</label>
                    <select class="input-field" id="expenseCategory">
                        <option value="é£²é£Ÿ">ğŸœ é£²é£Ÿ</option><option value="äº¤é€š">ğŸšƒ äº¤é€š</option><option value="ä½å®¿">ğŸ¨ ä½å®¿</option>
                        <option value="è³¼ç‰©">ğŸ›ï¸ è³¼ç‰©</option><option value="é–€ç¥¨">ğŸ« é–€ç¥¨</option><option value="å…¶ä»–">ğŸ“Œ å…¶ä»–</option>
                    </select>
                </div>
            </div>
            <div class="input-group"><label class="input-label">é …ç›®åç¨±</label><input type="text" class="input-field" id="expenseItem" placeholder="ä¾‹ï¼šæ‹‰éºµåˆé¤"></div>
            <div class="input-row" style="margin-bottom:14px;">
                <div class="input-group"><label class="input-label">é‡‘é¡</label><input type="number" class="input-field" id="expenseAmount" placeholder="0"></div>
                <div class="input-group"><label class="input-label">å¹£åˆ¥</label>
                    <select class="input-field" id="expenseCurrency">
                        <option value="JPY">ğŸ‡¯ğŸ‡µ JPY</option><option value="KRW">ğŸ‡°ğŸ‡· KRW</option><option value="THB">ğŸ‡¹ğŸ‡­ THB</option>
                        <option value="USD">ğŸ‡ºğŸ‡¸ USD</option><option value="TWD">ğŸ‡¹ğŸ‡¼ TWD</option>
                    </select>
                </div>
            </div>
            <div class="input-group"><label class="input-label">æ”¯ä»˜æ–¹å¼</label>
                <select class="input-field" id="expensePayment">
                    <option value="ç¾é‡‘">ğŸ’µ ç¾é‡‘</option><option value="ä¿¡ç”¨å¡">ğŸ’³ ä¿¡ç”¨å¡</option><option value="Suica/ICOCA">ğŸšƒ Suica</option>
                    <option value="PayPay">ğŸ“± PayPay</option><option value="LINE Pay">ğŸ“± LINE Pay</option><option value="å…¶ä»–">ğŸ“Œ å…¶ä»–</option>
                </select>
            </div>
            <div class="input-group"><label class="input-label">å‚™è¨» (é¸å¡«)</label><input type="text" class="input-field" id="expenseNote" placeholder="å‚™è¨»..."></div>
            <div class="action-row">
                <button class="btn btn-outline" onclick="closeModal('expenseModal')">å–æ¶ˆ</button>
                <button class="btn btn-orange" onclick="saveExpense()">å„²å­˜</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="shoppingModal">
        <div class="modal">
            <div class="modal-handle"></div>
            <div class="modal-title">ğŸ›’ æ–°å¢è³¼ç‰©é …ç›®</div>
            <div class="input-group"><label class="input-label">å•†å“åç¨±</label><input type="text" class="input-field" id="shopItem" placeholder="ä¾‹ï¼šè—¥å¦ã€é›¶é£Ÿ..."></div>
            <div class="input-row" style="margin-bottom:14px;">
                <div class="input-group"><label class="input-label">é ç®—</label><input type="number" class="input-field" id="shopBudget" placeholder="0"></div>
                <div class="input-group"><label class="input-label">å„ªå…ˆåº¦</label>
                    <select class="input-field" id="shopPriority"><option value="high">ğŸ”´ å¿…è²·</option><option value="medium">ğŸŸ¡ æƒ³è²·</option><option value="low">ğŸŸ¢ éš¨æ„</option></select>
                </div>
            </div>
            <div class="input-group"><label class="input-label">è³¼è²·åœ°é» (é¸å¡«)</label>
                <select class="input-field" id="shopStore">
                    <option value="">æœªæŒ‡å®š</option><option value="è—¥å¦åº—">ğŸ’Š è—¥å¦åº—</option><option value="ä¾¿åˆ©å•†åº—">ğŸª ä¾¿åˆ©å•†åº—</option>
                    <option value="ç™¾è²¨å…¬å¸">ğŸ¬ ç™¾è²¨å…¬å¸</option><option value="Outlet">ğŸ›ï¸ Outlet</option><option value="æ©Ÿå ´å…ç¨…">âœˆï¸ æ©Ÿå ´å…ç¨…</option>
                </select>
            </div>
            <div class="action-row">
                <button class="btn btn-outline" onclick="closeModal('shoppingModal')">å–æ¶ˆ</button>
                <button class="btn btn-pink" onclick="saveShopping()">å„²å­˜</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="dayModal">
        <div class="modal">
            <div class="modal-handle"></div>
            <div class="modal-title">ğŸ“… æ–°å¢è¡Œç¨‹æ—¥</div>
            <div class="input-group"><label class="input-label">æ—¥æœŸ</label><input type="date" class="input-field" id="newDayDate"></div>
            <div class="input-group"><label class="input-label">æ¨™é¡Œ (é¸å¡«)</label><input type="text" class="input-field" id="newDayTitle" placeholder="ä¾‹ï¼šæŠµé”æ—¥"></div>
            <div class="action-row">
                <button class="btn btn-outline" onclick="closeModal('dayModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveNewDay()">å„²å­˜</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="exportModal">
        <div class="modal">
            <div class="modal-handle"></div>
            <div class="modal-title">ğŸ“Š åŒ¯å‡ºè³‡æ–™</div>
            <div style="text-align:center;padding:20px 0;"><div style="font-size:3em;margin-bottom:12px;">ğŸ“Š</div><p style="color:var(--text-dim);">åŒ¯å‡ºå®Œæ•´çš„æ—…éŠç´€éŒ„ç‚º Excel æª”æ¡ˆ</p></div>
            <button class="btn btn-secondary" onclick="exportToExcel()">ğŸ“¥ ä¸‹è¼‰ Excel (.xlsx)</button>
            <button class="btn btn-outline" style="margin-top:10px;" onclick="closeModal('exportModal')">å–æ¶ˆ</button>
        </div>
    </div>
    
    <script>
        // ============================================
        // æ™¯é»è³‡æ–™åº«ï¼ˆå¯æ“´å……ï¼‰
        // ============================================
        const ATTRACTIONS_DB = {
            'ğŸ‡¯ğŸ‡µ æ±äº¬': {
                spots: [
                    { name: 'æ±äº¬éµå¡”', type: 'æ™¯é»', location: 'æ±äº¬éƒ½æ¸¯å€', time: '09:00-11:00' },
                    { name: 'æ·ºè‰å¯º', type: 'æ™¯é»', location: 'æ±äº¬éƒ½å°æ±å€', time: '10:00-12:00' },
                    { name: 'æ™´ç©ºå¡”', type: 'æ™¯é»', location: 'æ±äº¬éƒ½å¢¨ç”°å€', time: '14:00-16:00' },
                    { name: 'æ¶‰è°·åå­—è·¯å£', type: 'æ™¯é»', location: 'æ±äº¬éƒ½æ¸‹è°·å€', time: '15:00-17:00' },
                    { name: 'æ–°å®¿å¾¡è‹‘', type: 'æ™¯é»', location: 'æ±äº¬éƒ½æ–°å®¿å€', time: '09:00-11:00' },
                    { name: 'æ˜æ²»ç¥å®®', type: 'æ™¯é»', location: 'æ±äº¬éƒ½æ¸‹è°·å€', time: '08:00-10:00' },
                    { name: 'ç§‹è‘‰åŸé›»å™¨è¡—', type: 'è³¼ç‰©', location: 'æ±äº¬éƒ½åƒä»£ç”°å€', time: '13:00-17:00' },
                    { name: 'ä¸Šé‡å‹•ç‰©åœ’', type: 'æ™¯é»', location: 'æ±äº¬éƒ½å°æ±å€', time: '09:30-14:00' },
                    { name: 'ç¯‰åœ°å¸‚å ´', type: 'ç¾é£Ÿ', location: 'æ±äº¬éƒ½ä¸­å¤®å€', time: '07:00-10:00' },
                    { name: 'åŸå®¿ç«¹ä¸‹é€š', type: 'è³¼ç‰©', location: 'æ±äº¬éƒ½æ¸‹è°·å€', time: '11:00-15:00' },
                    { name: 'å…­æœ¬æœ¨ä¹‹ä¸˜', type: 'æ™¯é»', location: 'æ±äº¬éƒ½æ¸¯å€', time: '18:00-21:00' },
                    { name: 'å°å ´æµ·æ¿±å…¬åœ’', type: 'æ™¯é»', location: 'æ±äº¬éƒ½æ¸¯å€', time: '14:00-18:00' },
                ],
                foods: ['ä¸€è˜­æ‹‰éºµ', 'å£½å¸å¤§', 'ç‰›ã‚«ãƒ„ã‚‚ã¨æ‘', 'æ•˜æ•˜è‹‘ç‡’è‚‰', 'AFURIæŸšå­æ‹‰éºµ', 'å¤©ä¸¼ã¦ã‚“ã‚„'],
                defaultSchedule: [
                    { title: 'æŠµé”æˆç”°/ç¾½ç”°æ©Ÿå ´', type: 'äº¤é€š', time: '12:00-14:00' },
                    { title: 'é£¯åº— Check-in', type: 'ä½å®¿', time: '15:00-16:00' },
                ]
            },
            'ğŸ‡¯ğŸ‡µ å¤§é˜ª': {
                spots: [
                    { name: 'å¤§é˜ªåŸ', type: 'æ™¯é»', location: 'å¤§é˜ªå¸‚ä¸­å¤®å€', time: '09:00-12:00' },
                    { name: 'é“é “å €', type: 'ç¾é£Ÿ', location: 'å¤§é˜ªå¸‚ä¸­å¤®å€', time: '17:00-21:00' },
                    { name: 'å¿ƒé½‹æ©‹', type: 'è³¼ç‰©', location: 'å¤§é˜ªå¸‚ä¸­å¤®å€', time: '13:00-17:00' },
                    { name: 'é€šå¤©é–£', type: 'æ™¯é»', location: 'å¤§é˜ªå¸‚æµªé€Ÿå€', time: '10:00-12:00' },
                    { name: 'é»‘é–€å¸‚å ´', type: 'ç¾é£Ÿ', location: 'å¤§é˜ªå¸‚ä¸­å¤®å€', time: '08:00-11:00' },
                    { name: 'ç’°çƒå½±åŸ', type: 'æ™¯é»', location: 'å¤§é˜ªå¸‚æ­¤èŠ±å€', time: '09:00-20:00' },
                    { name: 'æµ·éŠé¤¨', type: 'æ™¯é»', location: 'å¤§é˜ªå¸‚æ¸¯å€', time: '10:00-15:00' },
                    { name: 'æ¢…ç”°ç©ºä¸­åº­åœ’', type: 'æ™¯é»', location: 'å¤§é˜ªå¸‚åŒ—å€', time: '18:00-21:00' },
                ],
                foods: ['ç« é­šç‡’', 'å¤§é˜ªç‡’', 'ä¸²ã‚«ãƒ„ã ã‚‹ã¾', 'èŸ¹é“æ¨‚', 'ä¸€è˜­æ‹‰éºµ'],
                defaultSchedule: [
                    { title: 'æŠµé”é—œè¥¿æ©Ÿå ´', type: 'äº¤é€š', time: '12:00-14:00' },
                    { title: 'æ­ä¹˜å—æµ·é›»éµåˆ°é›£æ³¢', type: 'äº¤é€š', time: '14:30-15:30' },
                ]
            },
            'ğŸ‡¯ğŸ‡µ äº¬éƒ½': {
                spots: [
                    { name: 'æ¸…æ°´å¯º', type: 'æ™¯é»', location: 'äº¬éƒ½å¸‚æ±å±±å€', time: '06:00-09:00' },
                    { name: 'ä¼è¦‹ç¨»è·å¤§ç¤¾', type: 'æ™¯é»', location: 'äº¬éƒ½å¸‚ä¼è¦‹å€', time: '08:00-11:00' },
                    { name: 'é‡‘é–£å¯º', type: 'æ™¯é»', location: 'äº¬éƒ½å¸‚åŒ—å€', time: '09:00-11:00' },
                    { name: 'åµå±±ç«¹æ—', type: 'æ™¯é»', location: 'äº¬éƒ½å¸‚å³äº¬å€', time: '08:00-12:00' },
                    { name: 'äºŒæ¢åŸ', type: 'æ™¯é»', location: 'äº¬éƒ½å¸‚ä¸­äº¬å€', time: '09:00-11:00' },
                    { name: 'ç¥‡åœ’èŠ±è¦‹å°è·¯', type: 'æ™¯é»', location: 'äº¬éƒ½å¸‚æ±å±±å€', time: '16:00-19:00' },
                    { name: 'å…«å‚ç¥ç¤¾', type: 'æ™¯é»', location: 'äº¬éƒ½å¸‚æ±å±±å€', time: '09:00-10:00' },
                    { name: 'éŒ¦å¸‚å ´', type: 'ç¾é£Ÿ', location: 'äº¬éƒ½å¸‚ä¸­äº¬å€', time: '10:00-13:00' },
                ],
                foods: ['æ¹¯è±†è…', 'æŠ¹èŒ¶ç”œé»', 'äº¬éƒ½æ‹‰éºµ', 'æ‡·çŸ³æ–™ç†'],
                defaultSchedule: []
            },
            'ğŸ‡¯ğŸ‡µ åŒ—æµ·é“': {
                spots: [
                    { name: 'å°æ¨½é‹æ²³', type: 'æ™¯é»', location: 'å°æ¨½å¸‚', time: '10:00-14:00' },
                    { name: 'å¤§é€šå…¬åœ’', type: 'æ™¯é»', location: 'æœ­å¹Œå¸‚ä¸­å¤®å€', time: '09:00-11:00' },
                    { name: 'æœ­å¹Œé›»è¦–å¡”', type: 'æ™¯é»', location: 'æœ­å¹Œå¸‚ä¸­å¤®å€', time: '11:00-13:00' },
                    { name: 'ç™½è‰²æˆ€äººå…¬åœ’', type: 'æ™¯é»', location: 'æœ­å¹Œå¸‚è¥¿å€', time: '09:00-12:00' },
                    { name: 'ç‹¸å°è·¯å•†åº—è¡—', type: 'è³¼ç‰©', location: 'æœ­å¹Œå¸‚ä¸­å¤®å€', time: '14:00-18:00' },
                    { name: 'äºŒæ¢å¸‚å ´', type: 'ç¾é£Ÿ', location: 'æœ­å¹Œå¸‚ä¸­å¤®å€', time: '07:00-10:00' },
                    { name: 'å¯Œè‰¯é‡èŠ±ç”°', type: 'æ™¯é»', location: 'å¯Œè‰¯é‡å¸‚', time: '09:00-15:00' },
                    { name: 'ç¾ç‘›é’æ± ', type: 'æ™¯é»', location: 'ç¾ç‘›ç”º', time: '10:00-12:00' },
                ],
                foods: ['æˆå‰æ€æ±—çƒ¤è‚‰', 'å‘³å™Œæ‹‰éºµ', 'æµ·é®®ä¸¼', 'æ¹¯å’–å“©', 'èƒèŸ¹æ–™ç†'],
                defaultSchedule: []
            },
            'ğŸ‡¯ğŸ‡µ æ²–ç¹©': {
                spots: [
                    { name: 'é¦–é‡ŒåŸ', type: 'æ™¯é»', location: 'é‚£éœ¸å¸‚', time: '09:00-12:00' },
                    { name: 'åœ‹éš›é€š', type: 'è³¼ç‰©', location: 'é‚£éœ¸å¸‚', time: '14:00-18:00' },
                    { name: 'ç¾éº—æµ·æ°´æ—é¤¨', type: 'æ™¯é»', location: 'æœ¬éƒ¨ç”º', time: '09:00-15:00' },
                    { name: 'å¤å®‡åˆ©å³¶', type: 'æ™¯é»', location: 'ä»Šæ­¸ä»æ‘', time: '10:00-14:00' },
                    { name: 'è¬åº§æ¯›', type: 'æ™¯é»', location: 'æ©ç´æ‘', time: '15:00-17:00' },
                    { name: 'æ³¢ä¸Šå®®', type: 'æ™¯é»', location: 'é‚£éœ¸å¸‚', time: '09:00-10:00' },
                ],
                foods: ['æ²–ç¹©éºµ', 'æµ·è‘¡è„', 'å¡”å¯é£¯', 'çŸ³å£ç‰›'],
                defaultSchedule: []
            },
            'ğŸ‡°ğŸ‡· é¦–çˆ¾': {
                spots: [
                    { name: 'æ™¯ç¦å®®', type: 'æ™¯é»', location: 'é¦–çˆ¾é˜è·¯å€', time: '09:00-12:00' },
                    { name: 'åŒ—æ‘éŸ“å±‹æ‘', type: 'æ™¯é»', location: 'é¦–çˆ¾é˜è·¯å€', time: '10:00-12:00' },
                    { name: 'æ˜æ´', type: 'è³¼ç‰©', location: 'é¦–çˆ¾ä¸­å€', time: '14:00-18:00' },
                    { name: 'Né¦–çˆ¾å¡”', type: 'æ™¯é»', location: 'é¦–çˆ¾é¾å±±å€', time: '18:00-21:00' },
                    { name: 'å¼˜å¤§', type: 'è³¼ç‰©', location: 'é¦–çˆ¾éº»æµ¦å€', time: '15:00-20:00' },
                    { name: 'æ±å¤§é–€', type: 'è³¼ç‰©', location: 'é¦–çˆ¾ä¸­å€', time: '20:00-24:00' },
                    { name: 'å»£è—å¸‚å ´', type: 'ç¾é£Ÿ', location: 'é¦–çˆ¾é˜è·¯å€', time: '10:00-13:00' },
                    { name: 'æ¢¨èŠ±å¥³å­å¤§å­¸', type: 'æ™¯é»', location: 'é¦–çˆ¾è¥¿å¤§é–€å€', time: '14:00-16:00' },
                ],
                foods: ['éŸ“å¼çƒ¤è‚‰', 'éƒ¨éšŠé‹', 'ç‚¸é›å•¤é…’', 'äººè”˜é›æ¹¯', 'è¾£ç‚’å¹´ç³•'],
                defaultSchedule: []
            },
            'ğŸ‡¹ğŸ‡­ æ³°åœ‹': {
                spots: [
                    { name: 'å¤§çš‡å®®', type: 'æ™¯é»', location: 'æ›¼è°·', time: '08:30-12:00' },
                    { name: 'é„­ç‹å»Ÿ', type: 'æ™¯é»', location: 'æ›¼è°·', time: '08:00-10:00' },
                    { name: 'æ°åœ–æ°é€±æœ«å¸‚å ´', type: 'è³¼ç‰©', location: 'æ›¼è°·', time: '09:00-17:00' },
                    { name: 'è€ƒå±±è·¯', type: 'æ™¯é»', location: 'æ›¼è°·', time: '18:00-23:00' },
                    { name: 'å››é¢ä½›', type: 'æ™¯é»', location: 'æ›¼è°·', time: '09:00-10:00' },
                    { name: 'Terminal 21', type: 'è³¼ç‰©', location: 'æ›¼è°·', time: '11:00-20:00' },
                    { name: 'æ°´ä¸Šå¸‚å ´', type: 'æ™¯é»', location: 'æ›¼è°·è¿‘éƒŠ', time: '07:00-12:00' },
                ],
                foods: ['æ³°å¼ç‚’æ²³ç²‰', 'ç¶ å’–å“©', 'èŠ’æœç³¯ç±³é£¯', 'å†¬è”­åŠŸæ¹¯', 'æ³°å¼å¥¶èŒ¶'],
                defaultSchedule: []
            },
            'ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡': {
                spots: [
                    { name: 'é­šå°¾ç…å…¬åœ’', type: 'æ™¯é»', location: 'æ¿±æµ·ç£', time: '09:00-11:00' },
                    { name: 'æ¿±æµ·ç£é‡‘æ²™', type: 'æ™¯é»', location: 'æ¿±æµ·ç£', time: '11:00-14:00' },
                    { name: 'è–æ·˜æ²™å³¶', type: 'æ™¯é»', location: 'è–æ·˜æ²™', time: '09:00-18:00' },
                    { name: 'ç‰›è»Šæ°´', type: 'ç¾é£Ÿ', location: 'ç‰›è»Šæ°´', time: '11:00-14:00' },
                    { name: 'å°å°åº¦', type: 'æ™¯é»', location: 'å°å°åº¦', time: '10:00-12:00' },
                    { name: 'çƒç¯€è·¯', type: 'è³¼ç‰©', location: 'çƒç¯€', time: '14:00-19:00' },
                    { name: 'æ¿±æµ·ç£èŠ±åœ’', type: 'æ™¯é»', location: 'æ¿±æµ·ç£', time: '18:00-21:00' },
                    { name: 'å…‹æ‹‰ç¢¼é ­', type: 'ç¾é£Ÿ', location: 'å…‹æ‹‰ç¢¼é ­', time: '18:00-22:00' },
                ],
                foods: ['æµ·å—é›é£¯', 'è¾£æ¤’èƒèŸ¹', 'è‚‰éª¨èŒ¶', 'æ²™å—²', 'å»æ²™'],
                defaultSchedule: []
            }
        };
        
        // ============================================
        // å¸¸æ•¸èˆ‡è®Šæ•¸
        // ============================================
        const STORAGE_KEY = 'travel_planner_v3';
        const TOKEN_KEY = 'travel_google_token';
        const TOKEN_SOFT_EXPIRE = 24 * 60 * 60;
        const DISCOVERY_DOCS = ['https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest'];
        const SCOPES = 'https://www.googleapis.com/auth/calendar.events';
        
        let tokenClient, gapiInited = false, gisInited = false;
        
        let appData = {
            trip: { name: '', destination: '', customDestination: '', startDate: '', endDate: '', mainCurrency: 'JPY' },
            days: [],
            expenses: [],
            shopping: [],
            settings: { googleClientId: '', lineToken: '', lineUserId: '', gasUrl: '', gasSecret: '', storageEnabled: true }
        };
        
        // ============================================
        // åˆå§‹åŒ–
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            renderAll();
            initGoogleAPI();
        });
        
        // ============================================
        // è‡ªå‹•ç”¢ç”Ÿå»ºè­°è¡Œç¨‹
        // ============================================
        function showAutoGenerateModal() {
            const dest = appData.trip.destination;
            const content = document.getElementById('autoGenerateContent');
            
            if (!dest || !appData.trip.startDate || !appData.trip.endDate) {
                content.innerHTML = `
                    <div style="text-align:center;padding:20px;color:var(--text-dim);">
                        <div style="font-size:2em;margin-bottom:10px;">âš ï¸</div>
                        <p>è«‹å…ˆåœ¨é¦–é è¨­å®š<strong>ç›®çš„åœ°</strong>å’Œ<strong>æ—¥æœŸ</strong></p>
                    </div>
                `;
                showModal('autoGenerateModal');
                return;
            }
            
            const dbData = ATTRACTIONS_DB[dest];
            if (!dbData) {
                content.innerHTML = `
                    <div style="text-align:center;padding:20px;color:var(--text-dim);">
                        <div style="font-size:2em;margin-bottom:10px;">ğŸ“</div>
                        <p>ç›®å‰ã€Œ${dest}ã€å°šç„¡å»ºè­°æ™¯é»è³‡æ–™åº«</p>
                        <p style="margin-top:10px;font-size:0.9em;">æ‚¨å¯ä»¥æ‰‹å‹•æ–°å¢è¡Œç¨‹</p>
                    </div>
                `;
                showModal('autoGenerateModal');
                return;
            }
            
            const dayCount = appData.days.length || calculateDays();
            
            content.innerHTML = `
                <div style="text-align:center;margin-bottom:20px;">
                    <div style="font-size:2em;margin-bottom:10px;">âœ¨</div>
                    <p style="color:var(--cyan);font-weight:600;">${dest}</p>
                    <p style="color:var(--text-dim);">${dayCount} å¤©è¡Œç¨‹å»ºè­°</p>
                </div>
                
                <div class="suggest-section">
                    <div class="suggest-title">ğŸ›ï¸ å¯é¸æ™¯é»ï¼ˆ${dbData.spots.length}å€‹ï¼‰</div>
                    <div class="suggest-chips" id="spotsChipsContainer">
                        ${dbData.spots.map((s, i) => `<span class="suggest-chip selected" data-index="${i}">${s.name}</span>`).join('')}
                    </div>
                </div>
                
                <div class="suggest-section">
                    <div class="suggest-title">ğŸœ æ¨è–¦ç¾é£Ÿ</div>
                    <div class="suggest-chips">
                        ${dbData.foods.map(f => `<span class="suggest-chip">${f}</span>`).join('')}
                    </div>
                </div>
                
                <p style="font-size:0.85em;color:var(--text-muted);text-align:center;margin-top:10px;">
                    é»æ“Šå¯å–æ¶ˆé¸æ“‡ï¼Œç³»çµ±æœƒè‡ªå‹•åˆ†é…åˆ°å„å¤©
                </p>
            `;
            
            // ç¶å®šé»æ“Šäº‹ä»¶
            content.querySelectorAll('.suggest-chip').forEach(chip => {
                chip.addEventListener('click', () => chip.classList.toggle('selected'));
            });
            
            showModal('autoGenerateModal');
        }
        
        function calculateDays() {
            if (!appData.trip.startDate || !appData.trip.endDate) return 0;
            const start = new Date(appData.trip.startDate);
            const end = new Date(appData.trip.endDate);
            return Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
        }
        
        function confirmAutoGenerate() {
            const dest = appData.trip.destination;
            const dbData = ATTRACTIONS_DB[dest];
            
            if (!dbData) {
                closeModal('autoGenerateModal');
                return;
            }
            
            // å–å¾—é¸ä¸­çš„æ™¯é»ï¼ˆå¾æ™¯é»å€å¡Šé¸å–ï¼‰
            const spotsContainer = document.getElementById('spotsChipsContainer');
            const selectedChips = spotsContainer ? spotsContainer.querySelectorAll('.suggest-chip.selected') : [];
            const selectedSpots = [];
            selectedChips.forEach(chip => {
                const idx = parseInt(chip.dataset.index);
                if (!isNaN(idx) && dbData.spots[idx]) {
                    selectedSpots.push(dbData.spots[idx]);
                }
            });
            
            if (selectedSpots.length === 0) {
                showToast('è«‹è‡³å°‘é¸æ“‡ä¸€å€‹æ™¯é»', 'error');
                return;
            }
            
            // ç¢ºä¿å·²ç”¢ç”Ÿå¤©æ•¸
            if (appData.days.length === 0) {
                const start = new Date(appData.trip.startDate);
                const end = new Date(appData.trip.endDate);
                generateDays(start, end);
            }
            
            // åˆ†é…æ™¯é»åˆ°å„å¤©
            const spotsPerDay = Math.ceil(selectedSpots.length / appData.days.length);
            let spotIndex = 0;
            
            appData.days.forEach((day, dayIdx) => {
                // ç¬¬ä¸€å¤©åŠ å…¥æŠµé”è¡Œç¨‹
                if (dayIdx === 0 && dbData.defaultSchedule.length > 0) {
                    dbData.defaultSchedule.forEach(ds => {
                        const times = ds.time.split('-');
                        day.schedules.push({
                            id: Date.now() + Math.random(),
                            startTime: times[0],
                            endTime: times[1],
                            title: ds.title,
                            type: ds.type,
                            location: '',
                            note: '',
                            reminders: [],
                            synced: false
                        });
                    });
                }
                
                // åˆ†é…æ™¯é»
                for (let i = 0; i < spotsPerDay && spotIndex < selectedSpots.length; i++) {
                    const spot = selectedSpots[spotIndex++];
                    const times = spot.time.split('-');
                    
                    day.schedules.push({
                        id: Date.now() + Math.random() + spotIndex,
                        startTime: times[0],
                        endTime: times[1],
                        title: spot.name,
                        type: spot.type,
                        location: spot.location,
                        note: '',
                        reminders: [],
                        synced: false
                    });
                }
                
                // æ’åºè¡Œç¨‹
                day.schedules.sort((a, b) => a.startTime.localeCompare(b.startTime));
            });
            
            saveData();
            renderItinerary();
            closeModal('autoGenerateModal');
            showToast(`âœ… å·²ç”¢ç”Ÿ ${selectedSpots.length} å€‹è¡Œç¨‹ï¼`, 'success');
            switchPage('itinerary');
        }
        
        // ============================================
        // å–å¾—å»ºè­°æ™¯é»ï¼ˆç”¨æ–¼æ‰‹å‹•æ–°å¢ï¼‰
        // ============================================
        function getSuggestions() {
            const dest = appData.trip.destination;
            const dbData = ATTRACTIONS_DB[dest];
            
            if (!dbData) return [];
            return dbData.spots;
        }
        
        function updateSuggestChips() {
            const container = document.getElementById('suggestChips');
            const suggestions = getSuggestions();
            
            if (suggestions.length === 0) {
                document.getElementById('suggestSection').style.display = 'none';
                return;
            }
            
            document.getElementById('suggestSection').style.display = 'block';
            container.innerHTML = suggestions.slice(0, 8).map(s => 
                `<span class="suggest-chip" onclick="selectSuggestion('${s.name}', '${s.type}', '${s.location}', '${s.time}')">${s.name}</span>`
            ).join('');
        }
        
        function selectSuggestion(name, type, location, time) {
            document.getElementById('scheduleTitle').value = name;
            document.getElementById('scheduleType').value = type;
            document.getElementById('scheduleLocation').value = location;
            
            const times = time.split('-');
            if (times.length === 2) {
                document.getElementById('scheduleStartTime').value = times[0];
                document.getElementById('scheduleEndTime').value = times[1];
            }
            
            // æ¨™è¨˜é¸ä¸­
            document.querySelectorAll('#suggestChips .suggest-chip').forEach(c => c.classList.remove('selected'));
            event.target.classList.add('selected');
        }
        
        // ============================================
        // é é¢åˆ‡æ›
        // ============================================
        function switchPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => {
                if (n.querySelector('.nav-label').textContent === {home:'é¦–é ',itinerary:'è¡Œç¨‹',expense:'è¨˜å¸³',shopping:'è³¼ç‰©',settings:'è¨­å®š'}[pageId]) {
                    n.classList.add('active');
                }
            });
        }
        
        // ============================================
        // æ—…éŠè³‡è¨Š
        // ============================================
        function handleDestinationChange() {
            const dest = document.getElementById('destination').value;
            document.getElementById('customDestGroup').style.display = dest === 'custom' ? 'block' : 'none';
            updateTripInfo();
        }
        
        function updateTripInfo() {
            const name = document.getElementById('tripName').value;
            const dest = document.getElementById('destination').value;
            const customDest = document.getElementById('customDestination').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            appData.trip.name = name;
            appData.trip.destination = dest === 'custom' ? customDest : dest;
            appData.trip.customDestination = customDest;
            appData.trip.startDate = startDate;
            appData.trip.endDate = endDate;
            
            document.getElementById('displayTripName').textContent = name || 'æˆ‘çš„æ—…è¡Œ';
            document.getElementById('displayDestination').textContent = appData.trip.destination || 'ğŸŒ é»æ“Šä¸‹æ–¹è¨­å®šç›®çš„åœ°';
            
            if (startDate && endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                document.getElementById('displayDates').textContent = `ğŸ“… ${formatDate(start)} ~ ${formatDate(end)} (${days}å¤©)`;
                document.getElementById('statDays').textContent = days;
                
                if (appData.days.length === 0) generateDays(start, end);
            }
            
            saveData();
        }
        
        function generateDays(start, end) {
            appData.days = [];
            let current = new Date(start);
            let dayNum = 1;
            while (current <= end) {
                appData.days.push({ id: Date.now() + dayNum, date: current.toISOString().split('T')[0], title: `Day ${dayNum}`, schedules: [] });
                current.setDate(current.getDate() + 1);
                dayNum++;
            }
            renderItinerary();
            saveData();
        }
        
        // ============================================
        // è¡Œç¨‹ç®¡ç†
        // ============================================
        function renderItinerary() {
            const container = document.getElementById('itineraryList');
            if (appData.days.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ“…</div><div>å°šæœªè¨­å®šè¡Œç¨‹<br>è«‹å…ˆåœ¨é¦–é è¨­å®šæ—…éŠæ—¥æœŸ</div></div>';
                return;
            }
            container.innerHTML = appData.days.map(day => {
                const scheduleHtml = day.schedules.length > 0 
                    ? day.schedules.map(s => `
                        <div class="schedule-item ${s.reminders?.length > 0 ? 'has-reminder' : ''} ${s.synced ? 'synced' : ''}">
                            <div class="schedule-time">${s.startTime} - ${s.endTime}</div>
                            <div class="schedule-title">${getTypeEmoji(s.type)} ${s.title}</div>
                            ${s.location ? `<div class="schedule-location">ğŸ“ ${s.location}</div>` : ''}
                            <div class="schedule-actions">
                                ${s.reminders?.length > 0 ? '<span class="schedule-badge reminder">ğŸ”” å·²è¨­æé†’</span>' : ''}
                                ${s.synced ? '<span class="schedule-badge synced">ğŸ“† å·²åŒæ­¥</span>' : ''}
                            </div>
                            <div class="schedule-actions" style="margin-top:6px;">
                                <button class="btn btn-outline btn-xs" onclick="deleteSchedule(${day.id}, ${s.id})">ğŸ—‘ï¸</button>
                                ${!s.synced ? `<button class="btn btn-secondary btn-xs" onclick="syncSingleToGoogle(${day.id}, ${s.id})">ğŸ“†</button>` : ''}
                            </div>
                        </div>
                    `).join('')
                    : '<div style="color:var(--text-muted);font-size:0.9em;padding:10px 0;">å°šç„¡è¡Œç¨‹å®‰æ’</div>';
                return `
                    <div class="day-card">
                        <div class="day-header" onclick="toggleDayContent(${day.id})">
                            <div><div class="day-title">${day.title}</div><div class="day-date">${formatDate(new Date(day.date))} â€¢ ${day.schedules.length} å€‹è¡Œç¨‹</div></div>
                            <span id="dayArrow${day.id}">â–¼</span>
                        </div>
                        <div class="day-content" id="dayContent${day.id}">
                            ${scheduleHtml}
                            <button class="btn btn-outline btn-sm" onclick="showAddScheduleModal(${day.id})" style="margin-top:10px;">â• æ–°å¢è¡Œç¨‹</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function toggleDayContent(dayId) {
            const content = document.getElementById('dayContent' + dayId);
            const arrow = document.getElementById('dayArrow' + dayId);
            content.classList.toggle('show');
            arrow.textContent = content.classList.contains('show') ? 'â–²' : 'â–¼';
        }
        
        function showAddScheduleModal(dayId) {
            const select = document.getElementById('scheduleDay');
            select.innerHTML = appData.days.map(d => `<option value="${d.id}" ${d.id === dayId ? 'selected' : ''}>${d.title} (${formatDate(new Date(d.date))})</option>`).join('');
            
            document.getElementById('scheduleStartTime').value = '09:00';
            document.getElementById('scheduleEndTime').value = '10:00';
            document.getElementById('scheduleTitle').value = '';
            document.getElementById('scheduleType').value = 'æ™¯é»';
            document.getElementById('scheduleLocation').value = '';
            document.getElementById('scheduleNote').value = '';
            document.querySelectorAll('#scheduleModal .reminder-option').forEach(r => r.classList.remove('checked'));
            
            updateSuggestChips();
            showModal('scheduleModal');
        }
        
        function showAddDayModal() {
            document.getElementById('newDayDate').value = '';
            document.getElementById('newDayTitle').value = '';
            showModal('dayModal');
        }
        
        function saveNewDay() {
            const date = document.getElementById('newDayDate').value;
            const title = document.getElementById('newDayTitle').value;
            if (!date) { showToast('è«‹é¸æ“‡æ—¥æœŸ', 'error'); return; }
            const dayNum = appData.days.length + 1;
            appData.days.push({ id: Date.now(), date, title: title || `Day ${dayNum}`, schedules: [] });
            appData.days.sort((a, b) => new Date(a.date) - new Date(b.date));
            saveData();
            renderItinerary();
            closeModal('dayModal');
            showToast('å·²æ–°å¢è¡Œç¨‹æ—¥', 'success');
        }
        
        async function saveSchedule() {
            const dayId = parseInt(document.getElementById('scheduleDay').value);
            const startTime = document.getElementById('scheduleStartTime').value;
            const endTime = document.getElementById('scheduleEndTime').value;
            const title = document.getElementById('scheduleTitle').value;
            const type = document.getElementById('scheduleType').value;
            const location = document.getElementById('scheduleLocation').value;
            const note = document.getElementById('scheduleNote').value;
            const syncToGoogle = document.getElementById('syncToGoogle').checked;
            
            if (!title) { showToast('è«‹è¼¸å…¥æ´»å‹•åç¨±', 'error'); return; }
            
            const reminders = [];
            document.querySelectorAll('#scheduleModal .reminder-option.checked input[value]:not([id="syncToGoogle"])').forEach(input => {
                if (input.value !== 'google') reminders.push(parseInt(input.value));
            });
            
            const day = appData.days.find(d => d.id === dayId);
            if (day) {
                const schedule = { id: Date.now(), startTime, endTime, title, type, location, note, reminders, synced: false };
                day.schedules.push(schedule);
                day.schedules.sort((a, b) => a.startTime.localeCompare(b.startTime));
                
                if (syncToGoogle) {
                    const success = await addEventToGoogleCalendar(schedule, day);
                    if (success) schedule.synced = true;
                }
                
                if (reminders.length > 0) createLineReminders(day, schedule);
                
                saveData();
                renderItinerary();
                closeModal('scheduleModal');
                showToast('å·²æ–°å¢è¡Œç¨‹', 'success');
            }
        }
        
        function deleteSchedule(dayId, scheduleId) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤ï¼Ÿ')) return;
            const day = appData.days.find(d => d.id === dayId);
            if (day) {
                day.schedules = day.schedules.filter(s => s.id !== scheduleId);
                saveData();
                renderItinerary();
                showToast('å·²åˆªé™¤', 'success');
            }
        }
        
        // ============================================
        // Google Calendar
        // ============================================
        function initGoogleAPI() {
            if (typeof gapi !== 'undefined') {
                gapi.load('client', async function() {
                    try {
                        await gapi.client.init({ discoveryDocs: DISCOVERY_DOCS });
                        gapiInited = true;
                        loadSavedToken();
                    } catch (err) { console.error('GAPI init failed:', err); }
                });
            }
        }
        
        function saveGoogleToken(token) {
            try {
                localStorage.setItem(TOKEN_KEY, JSON.stringify({ token, savedAt: Date.now(), expiresIn: TOKEN_SOFT_EXPIRE, actualExpiresIn: token.expires_in || 3600 }));
            } catch (e) {}
        }
        
        function loadSavedToken() {
            try {
                const saved = localStorage.getItem(TOKEN_KEY);
                if (!saved) return false;
                const tokenData = JSON.parse(saved);
                const elapsed = (Date.now() - tokenData.savedAt) / 1000;
                if (elapsed < tokenData.expiresIn - 300) {
                    gapi.client.setToken(tokenData.token);
                    gisInited = true;
                    const remaining = Math.floor((tokenData.expiresIn - elapsed) / 3600);
                    const mins = Math.floor(((tokenData.expiresIn - elapsed) % 3600) / 60);
                    const statusEl = document.getElementById('googleAuthStatus');
                    statusEl.innerHTML = `âœ… å·²æˆæ¬Šï¼ˆå‰©é¤˜ç´„ ${remaining > 0 ? remaining + ' å°æ™‚ ' : ''}${mins} åˆ†é˜ï¼‰`;
                    statusEl.className = 'auth-status success';
                    statusEl.style.display = 'block';
                    return true;
                } else {
                    localStorage.removeItem(TOKEN_KEY);
                    return false;
                }
            } catch (e) { return false; }
        }
        
        function isTokenValid() {
            const token = gapi.client.getToken();
            if (!token) return false;
            try {
                const saved = localStorage.getItem(TOKEN_KEY);
                if (!saved) return !!token;
                const tokenData = JSON.parse(saved);
                return (Date.now() - tokenData.savedAt) / 1000 < tokenData.expiresIn - 60;
            } catch (e) { return !!token; }
        }
        
        function initTokenClient() {
            const clientId = document.getElementById('googleClientId').value.trim();
            if (!clientId) { showToast('è«‹å…ˆè¼¸å…¥ Google Client ID', 'error'); return false; }
            if (typeof google === 'undefined' || !google.accounts) { showToast('Google API å°šæœªè¼‰å…¥', 'error'); return false; }
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: clientId,
                scope: SCOPES,
                callback: function(response) {
                    if (response.error) { showToast('æˆæ¬Šå¤±æ•—: ' + response.error, 'error'); return; }
                    gisInited = true;
                    saveGoogleToken(response);
                    const statusEl = document.getElementById('googleAuthStatus');
                    statusEl.innerHTML = 'âœ… å·²æˆæ¬Šï¼ˆ24 å°æ™‚æœ‰æ•ˆï¼‰';
                    statusEl.className = 'auth-status success';
                    statusEl.style.display = 'block';
                    showToast('âœ… Google æ—¥æ›†æˆæ¬ŠæˆåŠŸï¼', 'success');
                }
            });
            return true;
        }
        
        function handleGoogleAuthorize() {
            if (isTokenValid()) { showToast('æˆæ¬Šä»ç„¶æœ‰æ•ˆ', 'success'); return; }
            if (!initTokenClient()) return;
            tokenClient.requestAccessToken({ prompt: '' });
        }
        
        async function addEventToGoogleCalendar(schedule, day) {
            if (!isTokenValid()) return false;
            const calendarEvent = {
                summary: schedule.title,
                location: schedule.location || '',
                description: schedule.note || '',
                start: { dateTime: day.date + 'T' + schedule.startTime + ':00', timeZone: 'Asia/Taipei' },
                end: { dateTime: day.date + 'T' + schedule.endTime + ':00', timeZone: 'Asia/Taipei' },
                reminders: { useDefault: false, overrides: [{ method: 'popup', minutes: 60 }] }
            };
            try {
                await gapi.client.calendar.events.insert({ calendarId: 'primary', resource: calendarEvent });
                return true;
            } catch (err) { return false; }
        }
        
        async function syncSingleToGoogle(dayId, scheduleId) {
            const day = appData.days.find(d => d.id === dayId);
            const schedule = day?.schedules.find(s => s.id === scheduleId);
            if (!day || !schedule) return;
            showToast('ğŸ”„ åŒæ­¥ä¸­...', 'info');
            if (await addEventToGoogleCalendar(schedule, day)) {
                schedule.synced = true;
                saveData();
                renderItinerary();
                showToast('âœ… åŒæ­¥æˆåŠŸ', 'success');
            } else {
                showToast('âŒ åŒæ­¥å¤±æ•—', 'error');
            }
        }
        
        async function syncAllToGoogleCalendar() {
            if (!isTokenValid()) { showToast('è«‹å…ˆæˆæ¬Š Google æ—¥æ›†', 'error'); return; }
            showToast('ğŸ”„ åŒæ­¥ä¸­...', 'info');
            let count = 0;
            for (const day of appData.days) {
                for (const schedule of day.schedules) {
                    if (!schedule.synced && await addEventToGoogleCalendar(schedule, day)) {
                        schedule.synced = true;
                        count++;
                    }
                }
            }
            saveData();
            renderItinerary();
            showToast(count > 0 ? `âœ… å·²åŒæ­¥ ${count} å€‹è¡Œç¨‹` : 'æ‰€æœ‰è¡Œç¨‹å·²åŒæ­¥', 'success');
        }
        
        // ============================================
        // LINE æé†’
        // ============================================
        function createLineReminders(day, schedule) {
            const { lineToken, lineUserId, gasUrl, gasSecret } = appData.settings;
            if (!lineToken || !lineUserId || !gasUrl || !gasSecret) return;
            const schedules = [];
            const startDateTime = new Date(day.date + 'T' + schedule.startTime + ':00');
            const endDateTime = new Date(day.date + 'T' + schedule.endTime + ':00');
            const labels = { 1440: 'å‰ 1 å¤©', 120: 'å‰ 2 å°æ™‚', 60: 'å‰ 1 å°æ™‚', 30: 'å‰ 30 åˆ†é˜' };
            schedule.reminders.forEach(mins => {
                const reminderTime = new Date(startDateTime.getTime() - mins * 60 * 1000);
                if (reminderTime > new Date()) {
                    schedules.push({ workshopTitle: schedule.title, workshopStart: startDateTime.toISOString(), workshopEnd: endDateTime.toISOString(), workshopLocation: schedule.location || '', reminderTime: reminderTime.toISOString(), reminderMinutes: mins, reminderLabel: labels[mins] || '' });
                }
            });
            if (schedules.length === 0) return;
            fetch(gasUrl, { method: 'POST', headers: { 'Content-Type': 'text/plain' }, body: JSON.stringify({ action: 'createSchedules', secret: gasSecret, token: lineToken, userId: lineUserId, schedules }) }).then(r => r.json()).then(result => { if (result.success) showToast('ğŸ”” å·²å»ºç«‹æé†’', 'success'); });
        }
        
        function testLineNotification() {
            const { lineToken, lineUserId, gasUrl, gasSecret } = appData.settings;
            if (!lineToken || !lineUserId || !gasUrl || !gasSecret) { showToast('è«‹å¡«å¯«å®Œæ•´è¨­å®š', 'error'); return; }
            showToast('ğŸ“¨ ç™¼é€ä¸­...', 'info');
            fetch(gasUrl, { method: 'POST', headers: { 'Content-Type': 'text/plain' }, body: JSON.stringify({ secret: gasSecret, token: lineToken, userId: lineUserId, message: 'ğŸ§ª æ¸¬è©¦é€šçŸ¥\n\nâœˆï¸ æ—…éŠè¦åŠƒé«˜æ‰‹å·²æˆåŠŸé€£æ¥ï¼' }) })
                .then(r => r.json())
                .then(result => showToast(result.success ? 'âœ… ç™¼é€æˆåŠŸ' : 'âŒ ' + result.error, result.success ? 'success' : 'error'))
                .catch(err => showToast('âŒ ' + err.message, 'error'));
        }
        
        function viewSchedules() {
            const { gasUrl, gasSecret } = appData.settings;
            if (!gasUrl || !gasSecret) { showToast('è«‹å…ˆè¨­å®š GAS', 'error'); return; }
            fetch(gasUrl, { method: 'POST', headers: { 'Content-Type': 'text/plain' }, body: JSON.stringify({ action: 'getSchedules', secret: gasSecret }) })
                .then(r => r.json())
                .then(result => showToast(result.success ? `ğŸ“‹ ${result.schedules?.length || 0} å€‹æ’ç¨‹` : 'âŒ æŸ¥è©¢å¤±æ•—', result.success ? 'success' : 'error'));
        }
        
        // ============================================
        // è¨˜å¸³ & è³¼ç‰©
        // ============================================
        function updateExpenseFilterOptions() {
            const select = document.getElementById('expenseFilterDate');
            select.innerHTML = '<option value="all">å…¨éƒ¨æ—¥æœŸ</option>' + appData.days.map(d => `<option value="${d.date}">${d.title}</option>`).join('');
        }
        
        function renderExpenses() {
            const filter = document.getElementById('expenseFilterDate').value;
            let filtered = filter === 'all' ? appData.expenses : appData.expenses.filter(e => e.date === filter);
            const totalJPY = appData.expenses.filter(e => e.currency === 'JPY').reduce((a, b) => a + b.amount, 0);
            const totalTWD = appData.expenses.filter(e => e.currency === 'TWD').reduce((a, b) => a + b.amount, 0);
            document.getElementById('expenseJPY').textContent = 'Â¥' + totalJPY.toLocaleString();
            document.getElementById('expenseTWD').textContent = '$' + totalTWD.toLocaleString();
            document.getElementById('expenseCount').textContent = appData.expenses.length;
            document.getElementById('statExpenseJPY').textContent = 'Â¥' + totalJPY.toLocaleString();
            document.getElementById('statExpenseTWD').textContent = '$' + totalTWD.toLocaleString();
            
            const container = document.getElementById('expenseList');
            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ’°</div><div>å°šç„¡èŠ±è²»ç´€éŒ„</div></div>';
                return;
            }
            container.innerHTML = filtered.slice().reverse().map(e => `
                <div class="expense-item">
                    <div class="expense-info">
                        <div class="expense-category">${getCategoryEmoji(e.category)} ${e.category}</div>
                        <div class="expense-name">${e.item}</div>
                        <div class="expense-meta">${e.payment}</div>
                    </div>
                    <div class="expense-amount ${e.currency === 'TWD' ? 'twd' : 'jpy'}">${getCurrencySymbol(e.currency)}${e.amount.toLocaleString()}</div>
                    <div class="expense-delete" onclick="deleteExpense(${e.id})">ğŸ—‘ï¸</div>
                </div>
            `).join('');
        }
        
        function showAddExpenseModal() {
            const select = document.getElementById('expenseDay');
            select.innerHTML = appData.days.map(d => `<option value="${d.date}">${d.title}</option>`).join('');
            document.getElementById('expenseItem').value = '';
            document.getElementById('expenseAmount').value = '';
            document.getElementById('expenseNote').value = '';
            showModal('expenseModal');
        }
        
        function saveExpense() {
            const date = document.getElementById('expenseDay').value;
            const category = document.getElementById('expenseCategory').value;
            const item = document.getElementById('expenseItem').value;
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const currency = document.getElementById('expenseCurrency').value;
            const payment = document.getElementById('expensePayment').value;
            if (!item || !amount) { showToast('è«‹å¡«å¯«é …ç›®å’Œé‡‘é¡', 'error'); return; }
            appData.expenses.push({ id: Date.now(), date, category, item, amount, currency, payment });
            saveData();
            renderExpenses();
            closeModal('expenseModal');
            showToast('å·²è¨˜éŒ„', 'success');
        }
        
        function deleteExpense(id) {
            if (!confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) return;
            appData.expenses = appData.expenses.filter(e => e.id !== id);
            saveData();
            renderExpenses();
        }
        
        function renderShopping() {
            const total = appData.shopping.length;
            const bought = appData.shopping.filter(s => s.bought).length;
            const progress = total > 0 ? Math.round((bought / total) * 100) : 0;
            document.getElementById('shoppingProgress').textContent = progress + '%';
            document.getElementById('shoppingProgressBar').style.width = progress + '%';
            
            const container = document.getElementById('shoppingList');
            if (total === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ›’</div><div>è³¼ç‰©æ¸…å–®æ˜¯ç©ºçš„</div></div>';
                return;
            }
            const sorted = [...appData.shopping].sort((a, b) => {
                if (a.bought !== b.bought) return a.bought ? 1 : -1;
                const p = { high: 0, medium: 1, low: 2 };
                return p[a.priority] - p[b.priority];
            });
            container.innerHTML = sorted.map(s => `
                <div class="shop-item ${s.bought ? 'bought' : ''}" onclick="toggleShopping(${s.id})">
                    <div class="shop-checkbox">${s.bought ? 'âœ“' : ''}</div>
                    <div class="shop-info">
                        <div class="shop-name">${s.item}</div>
                        <div class="shop-meta">${s.budget ? 'Â¥' + s.budget.toLocaleString() : ''}${s.store ? ' â€¢ ' + s.store : ''}</div>
                    </div>
                    <span class="shop-priority ${s.priority}">${{ high: 'å¿…è²·', medium: 'æƒ³è²·', low: 'éš¨æ„' }[s.priority]}</span>
                </div>
            `).join('');
        }
        
        function showAddShoppingModal() {
            document.getElementById('shopItem').value = '';
            document.getElementById('shopBudget').value = '';
            showModal('shoppingModal');
        }
        
        function saveShopping() {
            const item = document.getElementById('shopItem').value;
            const budget = parseFloat(document.getElementById('shopBudget').value) || 0;
            const priority = document.getElementById('shopPriority').value;
            const store = document.getElementById('shopStore').value;
            if (!item) { showToast('è«‹è¼¸å…¥å•†å“åç¨±', 'error'); return; }
            appData.shopping.push({ id: Date.now(), item, budget, priority, store, bought: false });
            saveData();
            renderShopping();
            closeModal('shoppingModal');
            showToast('å·²åŠ å…¥', 'success');
        }
        
        function toggleShopping(id) {
            const item = appData.shopping.find(s => s.id === id);
            if (item) { item.bought = !item.bought; saveData(); renderShopping(); }
        }
        
        // ============================================
        // åŒ¯å‡º & å„²å­˜
        // ============================================
        function exportToExcel() {
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet([['æ—…éŠåç¨±', appData.trip.name], ['ç›®çš„åœ°', appData.trip.destination], ['æ—¥æœŸ', appData.trip.startDate + ' ~ ' + appData.trip.endDate]]), 'æ—…éŠè³‡è¨Š');
            const scheduleData = [['æ—¥æœŸ', 'æ™‚é–“', 'æ´»å‹•', 'é¡å‹', 'åœ°é»']];
            appData.days.forEach(d => d.schedules.forEach(s => scheduleData.push([d.date, s.startTime + '-' + s.endTime, s.title, s.type, s.location])));
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(scheduleData), 'è¡Œç¨‹');
            const expenseData = [['æ—¥æœŸ', 'é¡åˆ¥', 'é …ç›®', 'é‡‘é¡', 'å¹£åˆ¥']];
            appData.expenses.forEach(e => expenseData.push([e.date, e.category, e.item, e.amount, e.currency]));
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(expenseData), 'èŠ±è²»');
            XLSX.writeFile(wb, (appData.trip.name || 'æ—…éŠè¦åŠƒ') + '.xlsx');
            closeModal('exportModal');
            showToast('âœ… å·²ä¸‹è¼‰', 'success');
        }
        
        function saveData() {
            if (!appData.settings.storageEnabled) return;
            try { localStorage.setItem(STORAGE_KEY, JSON.stringify(appData)); } catch (e) {}
        }
        
        function loadData() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) appData = { ...appData, ...JSON.parse(saved) };
            } catch (e) {}
        }
        
        function saveSettings() {
            appData.settings.googleClientId = document.getElementById('googleClientId').value;
            appData.settings.lineToken = document.getElementById('lineToken').value;
            appData.settings.lineUserId = document.getElementById('lineUserId').value;
            appData.settings.gasUrl = document.getElementById('gasUrl').value;
            appData.settings.gasSecret = document.getElementById('gasSecret').value;
            saveData();
        }
        
        function toggleStorage() {
            const toggle = document.getElementById('storageToggle');
            toggle.classList.toggle('active');
            appData.settings.storageEnabled = toggle.classList.contains('active');
            if (appData.settings.storageEnabled) saveData();
            showToast(appData.settings.storageEnabled ? 'âœ… å·²å•Ÿç”¨å„²å­˜' : 'âš ï¸ å·²åœç”¨å„²å­˜', 'success');
        }
        
        function clearAllData() {
            if (!confirm('ç¢ºå®šæ¸…é™¤æ‰€æœ‰è³‡æ–™ï¼Ÿ')) return;
            localStorage.removeItem(STORAGE_KEY);
            localStorage.removeItem(TOKEN_KEY);
            location.reload();
        }
        
        function renderAll() {
            document.getElementById('tripName').value = appData.trip.name || '';
            document.getElementById('destination').value = appData.trip.customDestination ? 'custom' : (appData.trip.destination || '');
            if (appData.trip.customDestination) {
                document.getElementById('customDestGroup').style.display = 'block';
                document.getElementById('customDestination').value = appData.trip.customDestination;
            }
            document.getElementById('startDate').value = appData.trip.startDate || '';
            document.getElementById('endDate').value = appData.trip.endDate || '';
            document.getElementById('mainCurrency').value = appData.trip.mainCurrency || 'JPY';
            document.getElementById('googleClientId').value = appData.settings.googleClientId || '';
            document.getElementById('lineToken').value = appData.settings.lineToken || '';
            document.getElementById('lineUserId').value = appData.settings.lineUserId || '';
            document.getElementById('gasUrl').value = appData.settings.gasUrl || '';
            document.getElementById('gasSecret').value = appData.settings.gasSecret || '';
            if (appData.settings.storageEnabled) document.getElementById('storageToggle').classList.add('active');
            updateTripInfo();
            renderItinerary();
            renderExpenses();
            renderShopping();
        }
        
        // ============================================
        // UI è¼”åŠ©
        // ============================================
        function showModal(id) { document.getElementById(id).classList.add('show'); }
        function closeModal(id) { document.getElementById(id).classList.remove('show'); }
        function toggleReminder(el) { el.classList.toggle('checked'); }
        function toggleVisibility(id) { const el = document.getElementById(id); el.type = el.type === 'password' ? 'text' : 'password'; }
        function showToast(msg, type = 'info') { const t = document.getElementById('toast'); t.textContent = msg; t.className = 'toast show ' + type; setTimeout(() => t.classList.remove('show'), 3000); }
        function formatDate(d) { const w = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­']; return `${d.getMonth()+1}/${d.getDate()} (${w[d.getDay()]})`; }
        function getTypeEmoji(t) { return { 'æ™¯é»': 'ğŸ›ï¸', 'ç¾é£Ÿ': 'ğŸœ', 'äº¤é€š': 'ğŸšƒ', 'ä½å®¿': 'ğŸ¨', 'è³¼ç‰©': 'ğŸ›ï¸', 'å…¶ä»–': 'ğŸ“Œ' }[t] || 'ğŸ“Œ'; }
        function getCategoryEmoji(c) { return { 'é£²é£Ÿ': 'ğŸœ', 'äº¤é€š': 'ğŸšƒ', 'ä½å®¿': 'ğŸ¨', 'è³¼ç‰©': 'ğŸ›ï¸', 'é–€ç¥¨': 'ğŸ«', 'å…¶ä»–': 'ğŸ“Œ' }[c] || 'ğŸ“Œ'; }
        function getCurrencySymbol(c) { return { 'JPY': 'Â¥', 'KRW': 'â‚©', 'THB': 'à¸¿', 'USD': '$', 'TWD': '$' }[c] || ''; }
        
        document.querySelectorAll('.modal-overlay').forEach(o => o.addEventListener('click', function(e) { if (e.target === this) this.classList.remove('show'); }));
    </script>
</body>
</html>
